---
- job:
    name: 'firmware-firmware-github-trigger'
    project-type: freestyle
    defaults: global
    description: 'Generated by job-builder'
    display-name: 'freifunk firmware github trigger'
    quiet-period: 5
    node: virtual-job
    scm:
      - git:
          url: https://github.com/freifunk-berlin/firmware
          wipe-workspace: false
          git-config-name: 'Jenkins Builder'
          git-config-email: 'admax@fe80.eu'
    triggers:
      - github:
        github-hooks: true
    publishers:
        - github-notifier
    properties:
      - github:
          url: https://github.com/freifunk-berlin/firmware
    builders:
      - trigger-builds:
        - project:
            - freifunk-firmware
          git-revision: true
          predefined-parameters: |
              UPLOAD_DIR=unstable/${BUILD_NUMBER}
              ARCH=ar71xx_generic
          block: true
        - project:
            - freifunk-firmware
          git-revision: true
          predefined-parameters: |
              UPLOAD_DIR=unstable/${BUILD_NUMBER}
              ARCH=ar71xx_mikrotik
          block: true
        - project:
            - freifunk-firmware
          git-revision: true
          predefined-parameters: |
              UPLOAD_DIR=unstable/${BUILD_NUMBER}
              ARCH=mpc85xx_generic
          block: true
        - project:
            - freifunk-firmware
          git-revision: true
          predefined-parameters: |
              UPLOAD_DIR=unstable/${BUILD_NUMBER}
              ARCH=ramips_mt7620
          block: true
        - project:
            - freifunk-firmware
          git-revision: true
          predefined-parameters: |
              UPLOAD_DIR=unstable/${BUILD_NUMBER}
              ARCH=ramips_mt7621
          block: true
        - project:
            - freifunk-firmware
          git-revision: true
          predefined-parameters: |
              UPLOAD_DIR=unstable/${BUILD_NUMBER}
              ARCH=x86_generic
          block: true

- job:
    name: 'freifunk-firmware'
    project-type: freestyle
    defaults: global
    description: 'Generated by job-builder'
    display-name: 'freifunk firmware'
    quiet-period: 5
    builders:
      - shell:
          !include-raw: freifunk-firmware.sh
    scm:
      - git:
          url: https://github.com/freifunk-berlin/firmware
          wipe-workspace: false
          git-config-name: 'Jenkins Builder'
          git-config-email: 'admax@fe80.eu'
    publishers:
        - warnings:
            workspace-file-scanners:
              - file-pattern: 'openwrt/logs/**'
                scanner: 'GNU Make + GNU C Compiler (gcc)'
            run-always: true
            only-use-stable-builds-as-reference: true
        - ssh:
            site: 'freifunk'
            target: '${UPLOAD_DIR}'
            source: 'firmwares/'
        - github-notifier
    properties:
      - github:
          url: https://github.com/freifunk-berlin/firmware
    parameters:
      - string:
          name: ARCH
          default: ar71xx_generic
          description: "Build for this architecture. E.g. ar71xx_generic"
      - string:
          name: UPLOAD_DIR
          default: "unstable/manual-${BUILD_NUMBER}"
          description: "Under which name the resulting build is uploaded"
