---
- project:
    name: lede
    jobs:
      - 'freifunk-firmware'

- job:
    name: 'firmware-firmware-pull-request'
    project-type: freestyle
    defaults: global
    description: 'Generated by job-builder'
    display-name: 'freifunk firmware pull requests'
    quiet-period: 5
    triggers:
        - github-pull-request:
            github-hooks: true
    publishers:
        - github-notifier
    builders:
      - trigger-builds:
        - project:
            - freifunk-firmware
          predefined-parameters: |
              BUILD_TYPE=unstable
              ARCH=ar71xx
#        - project:
#            - freifunk-firmware
#          predefined-parameters: |
#              BUILD_TYPE=unstable
#              ARCH=ar71xx_mikrotik
#        - project:
#            - freifunk-firmware
#          predefined-parameters: |
#              BUILD_TYPE=unstable
#              ARCH=mpc85xx
#        - project:
#            - freifunk-firmware
#          predefined-parameters: |
#              BUILD_TYPE=unstable
#              ARCH=ramips
#        - project:
#            - freifunk-firmware
#          predefined-parameters: |
#              BUILD_TYPE=unstable
#              ARCH=x86

- job:
    name: 'freifunk-firmware'
    project-type: freestyle
    defaults: global
    description: 'Generated by job-builder'
    display-name: 'freifunk firmware unstable'
    quiet-period: 5
    builders:
      - shell:
          !include-raw: freifunk-firmware.sh
    scm:
      - 'freifunk-firmware'
    publishers:
        - warnings:
            workspace-file-scanners:
              - file-pattern: 'lede/logs/**'
                scanner: 'GNU Make + GNU C Compiler (gcc)'
            run-always: true
            only-use-stable-builds-as-reference: true
    properties:
      - github:
          url: https://github.com/lynxis/firmware
    parameters:
      - string:
          name: ARCH
          default: ar71xx
          description: "Build for this architecture. E.g. ar71xx_generic"
      - string:
          name: BUILD_TYPE
          default: unstable
          description: "One in [stable, unstable, weekly]"

- scm:
    name: freifunk-firmware
    scm:
      - git:
          url: https://github.com/lynxis/firmware
          branches:
            - origin/master
          wipe-workspace: false
          git-config-name: 'Jenkins Builder'
          git-config-email: 'admax@fe80.eu'
